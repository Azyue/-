# 项目名：Foodmap
## 小程序  `地图案例`  开发项目
#
### 导入项目 配置项目过程

1. 打开微信开发者工具，导入项目；

2. 填写自己的APPID；

3. 开通云开发环境（请参考官方文档），上传 `cloud` 文件夹下所有的云函数，上传时选择 `上传并部署：云端安装依赖`；


4. 修改小程序资源配置：
- 4-1. 修改 `app.js` 大约在第11行的代码，如下：
```javascript
    wx.cloud.init({
        env: '(填写你自己云环境的ID)',
        traceUser: true,
    })
```


5. 点击`云开发`——>`更多`——>`内容管理`：开通内容管理，导入cms模型（注：导入cms成功后会自动创建一下数据表，只需手动修改数据表权限，如没有通过cms导入则需要手动创建数据表和手动修改数据表权限）；
- 5-1. 修改以下数据表权限；

```
    Collections   //收藏表,权限：所有用户可读，仅创建者可读写
    StoreList     //商店表，权限：自定义规则：都为：true（可读、可写）
    ChefList      //厨师表,权限：自定义规则：都为：true（可读、可写）
    UserList      //用户表，权限：自定义规则：都为：true（可读、可写）
    GoodsList     //商品表,权限：自定义规则：都为：true（可读、可写）
    HomeBanner    //轮播图表，权限：自定义规则：都为：true（可读、可写）
    HotCity       //热门城市表,权限：自定义规则：都为：true（可读、可写）
    SysCuisine    //系统菜系表,权限：自定义规则：都为：true（可读、可写）
    Comments      //评论表,权限：自定义规则：都为：true（可读、可写）
    SysMiniInfo   //小程序配置表,权限：自定义规则：都为：true（可读、可写）
```
- 5-2. 修改存储的数据权限：自定义规则：都为：true（可读、可写）；

6. 在登录后，手动去数据库里设置第一个初始的管理员信息，在 `UserList`表里把admin修改为true,把 `level`字段修改为：2 (代表超级管理员，具有添加普通管理员的权限)、1 (代表普通管理员)、0（代表普通用户）；

```json
    "admin":true,
    "level":2,
```
7. 添加管理员后，在小程序端进入后台系统——>小程序——>把`内容展示`的开关打开（新版本不用做这一步，默认正常显示）

8. 在StoreList、ChefList、GoodsList表里都创建`地理位置`索引：_location（索引名），非唯一（索引属性），location（索引字段）
，选择（地理位置）

9. 如果需要显示更远距离的数据，请把app.js文件里的如下代码修改：`maxDistance`数值越大显示越远；
```javascript
  globalData: {
    maxDistance:Number(5000) //以自己为中心的最远距离(m)
  },
```
10. 此小程序使用到的接口： wx.chooseLocation，（在home.js文件里308行代码处使用，在app.json文件108行代码处配置），请先去微信公众平台开通此接口（这一步没用到，可以直接选地点）


11. 编译运行。









